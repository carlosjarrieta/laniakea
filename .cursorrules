# Laniakea Project Rules for backend

## üõ† Tech Stack & Versions
* Siempre actua como un senior developer ruby on rails
* Intenta escribir el c√≥digo lo m√°s optimizado posible usando las mejores pr√°cticas de ruby on rails
* Siempre que sea possible usa DRY (Don't Repeat Yourself), no crees c√≥digo repetido, no controladores muy largos
* Usa Concerns para organizar el c√≥digo
* Usa ActiveJob para tareas as√≠ncronas
* Para el tema de las traducciones usa i18n y crea archivos de traducci√≥n en ingl√©s y espa√±ol en `config/locales` para cada modelo. Ejemplo si estamos trabajando con el modelo User, crearemos un archivo user.en.yml y user.es.yml
* IMPORTANTE: Sigue siempre el principio de "Backend-Driven UI Text". El frontend NO debe tener textos "hardcodeados" (cadenas de texto fijas). El backend debe servir todas las traducciones a trav√©s del endpoint `/locales/:locale`.
* Cada vez que crees o modifiques una vista o componente (Front o Back), ASEG√öRATE de agregar sus correspondientes claves de traducci√≥n en los archivos YML.

- **Ruby**: 3.2.2 (RVM)
- **Rails**: 7.1.6 (API Only)
- **Database**: PostgreSQL 18 (Local host, User: deploy)
- **Auth**: Devise + Devise-JWT (Sessions & Registrations custom JSON)
- **Background Jobs**: Sidekiq 6.5.5 (Redis Namespace: `laniakea`)
- **Storage**: ActiveStorage with DigitalOcean Spaces (S3 logic)
- **Timezone System**: Standard UTC in DB. Internal Rails time must sync with `user.timezone`.

## üìú Coding Patterns
- **Secrets Management**: Always use Figaro (`config/application.yml`). Use `DEVISE_JWT_SECRET_KEY` for JWT.
- **API Response**: Consistent JSON responses. NO `jbuilder`.
- **Git**: Clean commits. `tmp/` and `log/` are IGNORED.
- **i18n**: Rails is the "Source of Truth" for translations, served via API.
- **Roles**: Use User model `enum role: { advertiser: 0, superadmin: 1 }`. Default is `advertiser`.

## üöÄ Infrastructure
- **Deployment**: VPS (Pure Rails + Next.js PWA).
- **WebSockets**: ActionCable mounted on `/cable` with Redis adapter.
- **Redis**: Use namespace `laniakea` to avoid collisions on VPS.


# Laniakea Project Rules for frontend

## üõ† Tech Stack & Versions
* Next.js 14 (App Router)
* TypeScript
* Tailwind CSS
* PWA
* React Native
* Usar la libreria shadcn/ui para los componentes
* crear componentes en la carpeta app/components
* crear componente / dashboard iguales al los ejemplos que tiene la pagina de shadcn/ui
* Siempre crear custom hooks para la logica de negocio
* Intentar que los componentes sean cortos y reutilizables

## üì± Mobile First (OBLIGATORIO)
**CR√çTICO: SIEMPRE dise√±ar pensando primero en m√≥vil.**

### Principios de Dise√±o Responsive:
1. **Mobile First**: Escribir CSS base para m√≥vil, luego a√±adir breakpoints para pantallas m√°s grandes.
2. **Sidebar colapsable**: En m√≥vil el sidebar debe estar oculto por defecto y accesible mediante un bot√≥n hamburguesa.
3. **Contenido con max-width**: Los formularios y contenido principal NO deben ocupar todo el ancho disponible.
4. **Breakpoints Tailwind**: Usar `sm:`, `md:`, `lg:`, `xl:` para adaptar layouts.

### Ejemplo de Layout Responsive:
```tsx
// ‚úÖ CORRECTO - Mobile first
<div className="w-full max-w-2xl mx-auto px-4 md:px-0">
  {/* Contenido centrado con max-width */}
</div>

// ‚ùå INCORRECTO - Ocupa todo el ancho
<div className="w-full">
  {/* Formulario que se estira en toda la pantalla */}
</div>
```

### Reglas de Ancho de Contenido:
- **Formularios settings/profile**: `max-w-2xl` (672px)
- **Dashboard cards**: Grid responsive con `grid-cols-1 md:grid-cols-2 lg:grid-cols-4`
- **Modales**: `max-w-lg` o `max-w-xl`

## üìè Tama√±os de Componentes (OBLIGATORIO)
**CR√çTICO: Usar componentes compactos estilo shadcn/ui, NO componentes grandes.**

### Alturas Est√°ndar:
- **Inputs y Selects**: `h-8` o `h-9` (32-36px) - NUNCA usar `h-10`, `h-11` o `h-12`
- **Botones peque√±os**: `h-8` (32px) con `size="sm"` y `text-xs`
- **Botones normales**: `h-9` (36px) con `text-sm`
- **Iconos en botones**: `size={14}` a `size={16}` (compactos)

### Estados de Foco (Inputs/Selects):
**CR√çTICO: Focus rings deben ser SUTILES, no exagerados.**
```tsx
// ‚úÖ CORRECTO - Focus ring sutil
className="h-9 text-sm border-border/60 focus-visible:ring-1 focus-visible:ring-primary/20 focus-visible:border-primary/50"

// ‚ùå INCORRECTO - Focus ring exagerado
className="h-9 focus-visible:ring-4 focus-visible:ring-primary"
```

### Bordes:
- **Siempre sutiles**: `border-border/60` o `border-border/40`
- **Al hacer focus**: `focus-visible:border-primary/50` (50% opacidad)
- **Hover en inputs**: `hover:border-border` (opcional)

### Espaciado:
- **Formularios**: `space-y-3` o `space-y-4` (NUNCA `space-y-6` o `space-y-8`)
- **Entre label e input**: `space-y-1.5` o `space-y-2`
- **Cards**: `gap-3` o `gap-4` entre elementos
- **Padding en Cards**: `p-4` o `p-6` (no exceder)

### Tipograf√≠a Compacta:
- **Labels**: `text-xs font-medium text-muted-foreground` (SIEMPRE muted)
- **Input text**: `text-sm` (placeholder tambi√©n)
- **T√≠tulos de Card**: `text-base font-medium` o `text-sm font-semibold`
- **Descripciones**: `text-xs text-muted-foreground`
- **Mensajes de error**: `text-xs text-destructive`

### Ejemplo COMPLETO de Input Correcto:
```tsx
// ‚úÖ CORRECTO - Exactamente como shadcn/ui
<FormItem className="space-y-1.5">
  <FormLabel className="text-xs font-medium text-muted-foreground">
    Email
  </FormLabel>
  <FormControl>
    <Input 
      type="email"
      placeholder="name@example.com"
      className="h-9 text-sm border-border/60 focus-visible:ring-1 focus-visible:ring-primary/20 focus-visible:border-primary/50" 
    />
  </FormControl>
  <FormMessage className="text-xs" />
</FormItem>

// ‚ùå INCORRECTO - Demasiado alto y con bordes exagerados
<FormItem>
  <FormLabel>Email</FormLabel>
  <Input 
    className="h-11 rounded-xl shadow-lg focus:ring-4" 
    placeholder="name@example.com"
  />
</FormItem>
```

### Ejemplo de Select Correcto:
```tsx
// ‚úÖ CORRECTO - Compacto
<Select>
  <SelectTrigger className="h-9 text-sm border-border/60">
    <SelectValue placeholder="Select option" />
  </SelectTrigger>
  <SelectContent>
    <SelectItem value="1">Option 1</SelectItem>
  </SelectContent>
</Select>
```

### Ejemplo de Bot√≥n Correcto:
```tsx
// ‚úÖ CORRECTO - Bot√≥n compacto con icono
<Button size="sm" className="h-8 px-3 text-xs font-medium gap-1.5">
  <Save size={14} />
  Save Changes
</Button>

// ‚ùå INCORRECTO - Bot√≥n grande
<Button className="h-11 px-8 rounded-xl shadow-lg gap-2">
  <Save size={20} />
  Save Changes
</Button>
```

## üé® Consistencia Visual y Tematizaci√≥n
**CR√çTICO: Todos los elementos de UI deben usar variables de color din√°micas, NUNCA colores fijos.**

### Colores de Botones y Componentes
- ‚ùå **NUNCA usar**: `bg-violet-600`, `bg-blue-500`, `text-green-600`, etc.
- ‚úÖ **SIEMPRE usar**: `bg-primary`, `text-primary`, `bg-secondary`, `bg-destructive`, etc.

### Ejemplos Correctos:
```tsx
// ‚úÖ CORRECTO - El bot√≥n cambiar√° seg√∫n el tema seleccionado
<Button className="bg-primary hover:bg-primary/90 text-primary-foreground">
  Guardar
</Button>

// ‚ùå INCORRECTO - El bot√≥n siempre ser√° violeta sin importar el tema
<Button className="bg-violet-600 hover:bg-violet-700 text-white">
  Guardar
</Button>
```

### Variables CSS Disponibles:
- `--background` / `--foreground` - Fondo y texto principal
- `--primary` / `--primary-foreground` - Color de acento principal
- `--secondary` / `--secondary-foreground` - Color secundario
- `--muted` / `--muted-foreground` - Elementos atenuados
- `--accent` / `--accent-foreground` - Acentos
- `--destructive` / `--destructive-foreground` - Acciones destructivas
- `--border`, `--input`, `--ring` - Bordes y focus

### Archivos de Temas:
- Los temas se definen en `frontend/app/themes/*.css`
- El tema base es `zinc.css` (variables en `:root`)
- Los temas de color usan clases como `.theme-blue`, `.theme-green`, etc.
- El `ThemeColorProvider` aplica la clase al `<body>` autom√°ticamente

## ‚å®Ô∏è Elementos Interactivos y Feedback
**CR√çTICO: Todo bot√≥n o icono de acci√≥n DEBE tener un Tooltip descriptivo.**

### Reglas de Tooltips:
1. **Obligatoriedad**: Todo bot√≥n (`<Button>`) que solo contenga un icono, o botones de acci√≥n en tablas/listas, DEBEN estar envueltos en un componente `Tooltip`.
2. **Accesibilidad**: El Tooltip ayuda a usuarios con lectores de pantalla y mejora la UX en interfaces compactas.
3. **Consistencia**: Usar el componente `Tooltip` de shadcn/ui.
4. **Traducci√≥n**: El contenido del Tooltip DEBE provenir de las traducciones (i18n).

### Ejemplo de Uso Correcto:
```tsx
<TooltipProvider>
  <Tooltip>
    <TooltipTrigger asChild>
      <Button variant="ghost" size="icon" className="h-9 w-9">
        <Edit2 size={14} />
      </Button>
    </TooltipTrigger>
    <TooltipContent>
      <p>{t('superadmin.actions.edit')}</p>
    </TooltipContent>
  </Tooltip>
</TooltipProvider>
```

### üö´ Di√°logos Nativos (PROHIBIDO)
**CR√çTICO: NUNCA usar `alert()`, `confirm()` o `prompt()` nativos del navegador.**
1.  **Est√©tica**: Los di√°logos nativos rompen la atm√≥sfera premium y el dise√±o "glassmorphism" de la aplicaci√≥n.
2.  **Alternativa**: Usar siempre el componente `@/components/confirm-dialog` para acciones cr√≠ticas o el `AlertDialog` de shadcn/ui.
3.  **Notificaciones**: Para alertas informativas r√°pidas, usar exclusivamente `toast` de la librer√≠a `sonner`.

**OBLIGATORIO: Nunca hardcodear textos en componentes.**

### Reglas de Traducci√≥n:
1. Todo texto visible al usuario DEBE usar el hook `useTranslations()`
2. Las claves se definen en `config/locales/es.yml` y `config/locales/en.yml`
3. El backend sirve traducciones v√≠a `/locales/:locale`

### Ejemplo de Uso:
```tsx
const { t } = useTranslations(currentLocale);

// ‚úÖ CORRECTO
<FormLabel>{t('settings.profile.theme_color')}</FormLabel>

// ‚ùå INCORRECTO
<FormLabel>Color del tema</FormLabel>
```

### Workflow de Traducciones:
1. A√±adir la clave en `es.yml` con el texto en espa√±ol
2. A√±adir la misma clave en `en.yml` con el texto en ingl√©s
3. Usar `t('clave.anidada')` en el componente
4. Verificar que ambos idiomas funcionan antes de hacer commit

## üìÅ Estructura de Archivos de Tema
```
frontend/app/themes/
‚îú‚îÄ‚îÄ zinc.css      # Tema base (default)
‚îú‚îÄ‚îÄ blue.css      # Tema azul
‚îú‚îÄ‚îÄ green.css     # Tema verde
‚îú‚îÄ‚îÄ violet.css    # Tema violeta
‚îú‚îÄ‚îÄ rose.css      # Tema rosa
‚îú‚îÄ‚îÄ orange.css    # Tema naranja
‚îú‚îÄ‚îÄ yellow.css    # Tema √°mbar
‚îî‚îÄ‚îÄ red.css       # Tema rojo
```

## üèõÔ∏è Vistas de Configuraci√≥n (Unified Layout)
**CR√çTICO: Todas las vistas dentro de `/settings` deben seguir el mismo patr√≥n visual unificado para consistencia.**

1. **Encabezado de P√°gina**:
   - T√≠tulo: `text-lg font-bold tracking-tight text-foreground`.
   - Descripci√≥n: `text-xs text-muted-foreground font-medium`.
   - Contenedor: `space-y-1` envuelto en un `div` con `space-y-6` para el contenido.

2. **Estilo de Cards**:
   - **Cabecera (CardHeader)**: Fondo `bg-muted/30`, borde inferior `border-b`, padding `p-5`.
   - **Iconograf√≠a**: Incluir un icono de `lucide-react` (size 16) con clase `text-primary` junto al t√≠tulo.
   - **T√≠tulos**: `text-sm font-bold`.
   - **Descripciones**: `text-[11px]`.
   - **Cuerpo (CardContent)**: Padding `p-5`.

3. **Formularios en Settings**:
   - **Labels**: `text-[10px] font-bold text-muted-foreground uppercase tracking-wider ml-0.5`.
   - **Inputs/Selects**: Estilo compacto con fondo `bg-muted/20`.
   - **Botones**: `h-9 px-6 text-xs font-bold rounded-lg shadow-sm`.

4. **Rendimiento y UX**:
   - **SIN TRANSICIONES**: NUNCA usar clases de `animate-in` o efectos de fade en las vistas de /settings para favorecer una experiencia instant√°nea.
   - **Tooltips**: Obligatorios en todos los botones de acci√≥n (especialmente los de iconos solos).
